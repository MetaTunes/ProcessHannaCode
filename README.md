# Hanna Code 

## Easily insert any complex HTML, Javascript or PHP output in your ProcessWire content by creating your own Hanna code tags.

This module is based loosely on the [WordPress Hana Code Insert](http://wordpress.org/plugins/hana-code-insert/) plugin.

A Hanna code tag looks like `[[hello_world]]`. A Hanna code tag with attributes looks like `[[hello_world foo="bar" bar="foo"]]`
using HTML style attributes or `[[hello_world foo=bar, bar=foo]]` using ProcessWire selector style attributes. After installing
the module, you define your Hanna codes in Setup > Hanna Code. 

These Hanna codes that you define can then be entered within your body copy (or other text where you allow) and they will
be replaced with the values defined or generated by your Hanna code. A common use case is to embed scripts or other bits
of HTML or codes that would usually be stripped out by an editor like TinyMCE. However, Hanna codes can be more than just
static snippets--they can be dynamic PHP or Javascript that outputs different things according to the request. PHP-based 
Hanna codes have access to the entire ProcessWire API. 

Hanna code accepts named attributes in the tag that can be passed as variables to PHP and Javascript Hanna codes. 
These attributes can be specified either in HTML attribute format or ProcessWire selector format. In either case, quotes
should be used around the attribute value when the value contains whitespace or a comma. 

## How to install

1. Place the module files in /site/modules/ProcessHannaCode/
2. In your admin, click Modules > Check for new modules
3. Click "install" for **TextformatterHannaCode** 
4. Now to go Setup > Fields and locate the Textarea field(s) that you want to use Hanna codes with ("body" for instance).
5. When editing the field, click the "details" tab, and select "Hanna Code" as the Textformatter. Save.
6. Now go to Setup > Hanna Code and start defining your Hanna Codes! You may want to use one of the examples from this document to get started.

## Tag format

Below is a Hanna code tag named hello_world with no attributes. If you pasted this into your body copy, you would get
whatever the replacement value is that you defined. 
```
[[hello_world]]
```

Below is a Hanna code tag named hello_world being passed attributes of foo, bar and foobar. If this were a PHP-based 
Hanna code, it would receive the variables $foo, $bar and $foobar: 
```
[[hello_world foo="bar" bar="foo" foobar="foo bar"]]
```
Below is the same Hanna code tag as above, but with attributes more like ProcessWire selectors. You can use whatever
format you prefer. Just note that unlike regular ProcessWire selectors, quotes (single or double) are required around
any value that has whitespace. 
```
[[hello_world, foo=bar, bar=foo, foobar="foo bar"]]
```

## How to use

Please make sure that you have completed the *How to install* section first. Then in your admin, go to Setup > Hanna Codes.

Each Hanna code that you add has a type of either: Text/HTML, Javascript or PHP. The Text/HTML type is literally 
self explanatory in that your `[[custom-tag]]` is replaced with exactly the text you paste in. Anywhere that you type your
`[[custom-tag]]` in your body copy will be replaced with exactly the static text you defined. 

More power opens up with the Javascript and/or PHP types of codes. These codes execute at runtime and thus can contain
specific logic to produce different results. In fact, PHP Hanna codes have access to the entire ProcessWire API and are
executed in the same manner as template files. Your PHP-based Hanna code should simply "echo" or "print" the replacement
value. 

### PHP example

- Create a new Hanna code with the *name* "children". 
- Select "PHP" as the *type*. 
- Paste in the following for the *code*:

```
foreach($page->children as $child) {
  echo "<p><a href='$child->url'>$child->title</a>";
}
```

- Now go and edit a page that has children. In the body copy, enter `[[children]]` in the place where you want the output to appear. 
- View the page, and you should see the rendered list of links to children. 

### PHP example, part 2

Now lets take the above example further... 

- Go back and edit your "children" Hanna code, as we are going to modify it to respond to a "parent" attribute. Change the code to this:

```
if(isset($parent)) {
  // If $parent is an ID or path, lets convert it to a Page
  $parent = $pages->get($parent);
} else {
  // otherwise lets assume the current page is the parent
  $parent = $page; 
}

foreach($parent->children as $child) {
  echo "<p><a href='$child->url'>$child->title</a>";
}
```

- Go back and edit the page where you previously inserted the `[[children]]` tag, and change it to:
`[[children, parent=1]]` (specifying the homepage) or `[[children, parent=/path/to/some/parent/]]` if you want to try something else. 

- View the page and you should now see it showing the children of the homepage (or of another parent you specified). 

**Please see the Javascript and PHP usage notes on the Hanna code entry screen.**

## Security 

There are major security implications with a tool that will let you enter unfiltered text and code from your web browser.
As a result, Hanna codes are meant for definition only by superusers and we recommend keeping it that way. 

## Using Hanna Code from the API

If you want to populate Hanna Code from the API, you can do so using the render() method, like this:

```
$hanna = $modules->get('TextformatterHannaCode'); 
$page->body = $hanna->render($page->body); 
```


------
Copyright 2013 by Ryan Cramer



